{% extends 'base_page.html' %}
{% block titulo_pagina %}SistemaWeb - Cadastrar Entidade {% endblock %}

{% block recursos_necessarios %}
  {% load static %}
	<script src="{% static 'bower_components/nprogress/nprogress.js' %}"></script>
	<link href="{% static 'bower_components/nprogress/nprogress.css' %}" rel="stylesheet">
	<link href="{% static 'modules/entity/entity.css' %}" rel="stylesheet">

  <style>
  .actionBar{
    display: none;
  }
  .wizard-step-bar .btn{
    width: 120px;
  }

  .multiselect {
    text-align: left;
  }

	tr.linha_selecionavel{
    cursor: pointer;
	}
  </style>
{% endblock %}

{% block conteudo_principal %}
<div id="angular_content" ng-cloak ng-app="modules.entity">
	<div class="x_panel" style="margin-top: -30px;padding:10px;">
		<div class="x_title">
			<h2>Cadastro de Entidade <!--<small>Click to validate</small>--></h2>
			<ul class="nav navbar-right panel_toolbox">
				<div class="btn-group" role="group" aria-label="...">
					<a href="#" id='bt_register_entity' role="button" class="btn btn-sm btn-success" ng-class="{true:'desabilitado', false:''}[registro_selecionado==null]"  data-toggle="modal" data-target="#modal_adicionar_contrato" ng-click="load_fields();esta_adicionando = true">Nova Entidade</a>
					<a href="#" id='bt_servicos' role="button" class="btn btn-sm btn-default" ng-class="{true:'desabilitado', false:''}[registro_selecionado==null]"  data-toggle="modal" data-target="#modal_servicos" ng-click="configurar_inclusao_servico();esta_adicionando = true" style='margin-left: 5px;'>Endereços</a>
					<a href="#" id='bt_indicacoes' role="button" class="btn btn-sm btn-default pull-left" ng-class="{true:'desabilitado', false:''}[registro_selecionado==null]" data-toggle="modal" data-target="#modal_indicacoes" ng-click="carregar_indicacao()" style='margin-left: 5px;'> Contatos</a>

					<div class="btn-group" role="group">
						<button type="button" id='bt_outras_acoes' class="btn btn-sm btn-default dropdown-toggle desabilitado" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="caret"></span>
						</button>
						<ul class="dropdown-menu dropdown-menu-right">
							<li><a href="#">Action</a></li>
							<li><a href="#">Another action</a></li>
							<li><a href="#">Desativar</a></li>
							<!--<li role="separator" class="divider"></li>
							<li><a href="#modal_justificativa" id="bt_desativar_cliente" data-toggle="modal">Desativar</a></li>-->
						</ul>
					</div>
				</div>
			</ul>
			<div class="clearfix"></div>
		</div>

		<div class="x_content">
			<div id="register_controller" ng-controller="register_controller">
				<div class="dataTable_wrapper">
				<div class='row'>
					<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
						<table id="table_entity" class="table table-striped table-bordered table-hover">
							<thead>
								<tr class="row_entity linha_cabecalho">
									<th class='col_index text-center' ng-click="sortType = 'id'; sortReverse = !sortReverse"></th>

									<th class="col_entity_type text-center" ng-hide='screen0 || screen1' ng-click="sortType = 'plano'; sortReverse = !sortReverse">Tipo</th>

									<th class="col_cpf_cnpj text-center" ng-hide='screen0 || screen1' ng-click="sortType = 'plano'; sortReverse = !sortReverse">CPF ou CNPJ</th>

									<th class='col_entity_name text-center' ng-click="sortType = 'cliente'; sortReverse = !sortReverse">Nome ou Razão</th>

									<th class='col_birth_date_foundation text-center' ng-hide='screen0 || screen1 || screen2 || screen3' ng-click="sortType = 'inicio'; sortReverse = !sortReverse">Nasc. ou Fundação</th>

									<th class='col_created_date text-center' ng-hide='screen0 || screen1 || screen2 || screen3' ng-click="sortType = 'termino'; sortReverse = !sortReverse">Cadastrado em</th>
								</tr>
							</thead>

							<div><!-- ng-show="contratos_carregados">-->
								<tbody>
								{% verbatim %}
								<tr ng-if="(contratos|filter:filterIds()).length == 0">
									<td colspan="8" class="center">Nenhum Cliente Cadastrado!</td>
								</tr>

								<tr class="row_entity linha_selecionavel" ng-repeat="entity in list_entities" ng-click="select_table_row(entity)" pagination-id="paginate_contratos" dir-paginate="contrato in contratos | filter: get_filter_column() | itemsPerPage:10 | orderBy:sortType:sortReverse as resultado">
									<td class='col_index'>{{ $index+1 }}</td>



									<td class="col_entity_type" ng-hide='screen0 || screen1' ng-class="{true:'left', false:'center'}[entity.entity_type=='']">
										{{ entity.entity_type }}
										<!--<span ng-if="entity.entity_type">{{ entity.entity_type }}</span>
										<span ng-if="!entity.entity_type"></span>-->
									</td>

									<td class="col_cpf_cnpj" ng-hide='screen0 || screen1' ng-class="{true:'left', false:'center'}[entity.cpf_cnpj=='']">
										{{ entity.cpf_cnpj }}
										<!--<span ng-if="entity.cpf_cnpj">{{ entity.cpf_cnpj }}</span>
										<span ng-if="!entity.cpf_cnpj"></span>-->
									</td>

									<td class="col_entity_name">
										{{ entity.name }}
										<!--<div class="responsive-text"  style="max-width: {{ col_cliente_size }}px">{{ contrato.cliente_nome }}</div> isso faz cortar as palavras mas temos um problema com alinhamento que nao fica perfeito dependendo de como a largura foi carregada inicialmente -->
									</td>

									<td class="col_birth_date_foundation" ng-hide='screen0 || screen1 || screen2 || screen3' ng-class="{true:'left', false:'center'}[entity.birth_date_foundation=='']" style="width: 80px;">
										{{entity.birth_date_foundation }}
										<!--<span ng-if="entity.birth_date_foundation">{{entity.birth_date_foundation }}</span>
										<span ng-if="!entity.birth_date_foundation"></span>-->
									</td>

									<td class="col_created_date" ng-hide='screen0 || screen1 || screen2 || screen3' ng-class="{true:'left', false:'center'}[entity.created_date=='']" style="width: 80px;">
										{{ entity.created_date}}
										<!--<span ng-if="entity.created_date">{{ entity.created_date}}</span>
										<span ng-if="!entity.created_date"></span>-->
									</td>
								</tr>

								<tr class="row_entity angular-repeat linha_selecionavel" ng-repeat="k in minimal_quantity_rows.slice(list_entities.length,minimal_quantity_rows.length)">
									<td class="col_index"></td>
									<td class="col_entity_type"></td>
									<td class='col_cpf_cnpj'></td>
									<td class="col_entity_name"></td>
									<td class='col_birth_date_foundation'></td>
									<td class='col_created_date'></td>
								</tr>

								<tr ng-if="resultado.length === 0 && (contratos|filter:filterIds()).length > 0">
									<td colspan="3" class='center'>Nenhum resultado Encontrado</td>
								</tr>
								{% endverbatim %}
								</tbody>
							</div>
						</table>
					</div>
				</div>
			</div>

				<div class='row no-gutter' style="padding: 0px 0px 10px 0px;">
				{% verbatim %}
				<div class="col-lg-2 col-md-2 col-sm-2 col-xs-12" style='margin-top:6px;'>
					<label id="label_buscar_por" class='left {{ desabilitar }}'><sub>Buscar por:</sub></label>
					<select id='buscar_por' class='form-control {{ desabilitar }}' ng-model="filter_by" ng-change="select_filter_by()">
						<option value="0">Código</option>
						<option value="1" selected>Cliente</option>
						<option value="2">Plano</option>
					</select>
				</div>

				<div class="col-lg-4 col-md-4 col-sm-4 col-xs-12" style='margin-top: 31px;'>
					<input type="text" id="search" ng-model='search' class="form-control {{ desabilitar }}" placeholder="Consultar..">
				</div>

				<div class="col-lg-offset-2 col-lg-4 col-md-6 col-sm-4 col-xs-12 mt-xs-0 pull-right" >
					<span class="pull-right" style="height: 64px;padding-top: 10px;"><!-- style="margin-top:-54px;margin-bottom: -30px;margin-right: 0px;">-->
						<dir-pagination-controls pagination-id="paginate_contratos" max-size="4" auto-hide="false" boundary-links="false" direction-links="true">

						</dir-pagination-controls>
					</span>
				</div>
				{% endverbatim %}
			</div>
			</div>
		</div>
	</div>
</div>


<!--Modal de adicao de Email -->
<div ng-controller="register_email_entity"><!-- Falta add um controlador-->
		<div id="modal_add_email" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
			<div class="modal-dialog" style="width: 50%">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
						<h5 style="font-weight: bold">Adicionar endereço de Email</h5>
					</div>
					<div class="modal-body">
						Olha como ta
					</div>
					<div class="modal-footer">
						<button role="button" class="btn btn-sm btn-success form-control" ng-click="save_email()">Salvar</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block recursos_complementares %}
{% load static %}
<script src="{% static 'modules/entity/entity_controller.js' %}"></script>
<script src="{% static 'modules/entity/entity.js' %}"></script>
<script src="{% static 'modules/entity/contact_controller.js' %}"></script>
<script src="{% static 'modules/entity/contact.js' %}"></script>
<link rel="stylesheet" href="{% static 'custom/smartwizard/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/bootstrap-multiselect.css' %}" type="text/css">
<script type="text/javascript" src="{% static 'custom/smartwizard/jQuery-Multiple-Select-Plugin-For-Bootstrap-Bootstrap-Multiselect/bootstrap-multiselect.js' %}"></script>
<script type="text/javascript" src="{% static 'bower_components/validator/validator.js' %}"></script>
<script type="text/javascript" src="{% static 'custom/mask/mask.js' %}"></script>
<script type="text/javascript">
	$(document).ready(function(){
		//$('#cpf_cnpj').mask('999.999.999-99');
		//$('#birth_date_foundation').mask('99/99/9999');

		angular.element(document.getElementById('register_controller')).scope().load_table_entity();
		//angular.element(document.getElementById('entity_table')).scope().select_table_row();
	});
</script>

<script>
		//document.getElementById("cpf_cnpj").onblur = function () {validate_cpf_cnpj()};
		//document.getElementById("birth_date_foundation").onblur = function () {validate_birth_date()};
		//document.getElementById('entity_name').onblur = function () {validate_entity_name()};
		//document.getElementById('fantasy_name').onblur = function () {validate_entity_fantasy()};

		function validate_cpf_cnpj (){
				validate_cpf('cpf_cnpj')
		}

		function validate_entity_name () {
				validate_field_entity('entity_name')
		}

		function validate_entity_fantasy () {
				validate_field_entity ('fantasy_name')
		}

		function validate_birth_date () {
				validate_date_person('birth_date_foundation')
				//validate_field_entity('birth_date_foundation')
		}
</script>

{% endblock %}